<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Walkthrough: Tracking an Elasticsearch Java Client Sniffer Bug</title>
    <meta name='description'
          content="Forter's technical blog, writing on security, performance, engineering culture, and more.">

    <link rel="canonical" href="http://localhost:4000/walkthrough-tracking-an-elasticsearch-java-client-sniffer-bug">
    <link rel="alternate" type="application/rss+xml" title="TECH.FORTER.COM" href="/feed.xml">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Walkthrough: Tracking an Elasticsearch Java Client Sniffer Bug – TECH.FORTER.COM">
    <meta name="twitter:description"
          content="Elasticsearch has always been good to us at Forter. It’s truly reliable. It’s damn good at searching, and it’s a solid distributed application as well. It balances a cluster relatively quickly, and it is easy to configure and easy to backup/restore, etc., but… we were haunted by an issue which had a catastrophic effect on our system.">
    <meta name="twitter:image:src" content="http://localhost:4000/images/post-img/rep.jpg">

    <!-- Facebook OpenGraph -->
    <meta property="og:title" content="Walkthrough: Tracking an Elasticsearch Java Client Sniffer Bug – TECH.FORTER.COM">
    <meta property="og:description"
          content="Elasticsearch has always been good to us at Forter. It’s truly reliable. It’s damn good at searching, and it’s a solid distributed application as well. It balances a cluster relatively quickly, and it is easy to configure and easy to backup/restore, etc., but… we were haunted by an issue which had a catastrophic effect on our system.">
    <meta property="og:image" content="http://localhost:4000/images/post-img/rep.jpg">

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700;900&display=swap"
          as="style">

    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@400;500;700;900&display=swap" rel="stylesheet">


    <!-- Ionicons -->
    <link rel="preload" href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" as="style">

    <link href="https://unpkg.com/ionicons@4.2.2/dist/css/ionicons.min.css" rel="stylesheet">

    <script>

        if (localStorage.getItem("theme") === "dark") {
            document.documentElement.setAttribute("dark", "");
            document.documentElement.classList.add('dark-mode');
        }

    </script>

    <style>

        /*!------------------------------------------------------------------
[MAIN STYLESHEET]
-------------------------------------------------------------------*/
        :root {
            --brand-color: #0073ec;
            --white: #fff;
            --light-gray: #f0f0f0;
            --light-blue: #f3f7ff;
            --blue-gray: #716f8a;
            --gray: #9e9e9e;
            --dark: #0c101a;
            --dark-blue: #1e2740;
            --background-color: var(--white);
            --background-alt-color: var(--light-blue);
            --text-color: var(--dark-blue);
            --text-alt-color: var(--blue-gray);
            --heading-font-color: var(--dark-blue);
            --link-color: var(--dark-blue);
            --link-color-hover: var(--dark-blue);
            --button-color: var(--white);
            --button-background-color: var(--brand-color);
            --button-background-hover: #4f31c7;
            --border-color: var(--light-blue);
            --border-color-alt: var(--light-blue);
            --th-color: var(--light-gray);
            --tr-color: var(--light-gray);
            --syntax-highlighting-background: #f3f3f3
        }

        [dark]:root {
            --brand-color: #0073ec;
            --white: #fff;
            --light-gray: #f0f0f0;
            --gray: #9e9e9e;
            --dark: #111016;
            --background-color: var(--dark);
            --background-alt-color: #1a1a1f;
            --text-color: var(--gray);
            --text-alt-color: var(--gray);
            --heading-font-color: var(--light-gray);
            --link-color: var(--light-gray);
            --link-color-hover: var(--light-gray);
            --button-color: var(--white);
            --button-background-color: var(--brand-color);
            --button-background-hover: #4f31c7;
            --border-color: #252629;
            --border-color-alt: #080b12;
            --th-color: #18181d;
            --tr-color: #080b12;
            --syntax-highlighting-background: #080b12
        }

        .list-reset {
            list-style-type: none;
            margin: 0;
            padding: 0
        }

        .clearfix::after, .clearfix ::before {
            content: "";
            display: table;
            clear: both
        }

        .screen-reader-text {
            clip: rect(1px, 1px, 1px, 1px);
            height: 1px;
            overflow: hidden;
            position: absolute !important;
            width: 1px;
            word-wrap: normal !important
        }

        /*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */
        html {
            line-height: 1.15;
            -webkit-text-size-adjust: 100%
        }

        body {
            margin: 0
        }

        h1 {
            font-size: 2em;
            margin: 0.67em 0
        }

        hr {
            box-sizing: content-box;
            height: 0;
            overflow: visible
        }

        pre {
            font-family: monospace, monospace;
            font-size: 1em
        }

        a {
            background-color: transparent
        }

        abbr[title] {
            border-bottom: none;
            text-decoration: underline;
            text-decoration: underline dotted
        }

        b, strong {
            font-weight: bolder
        }

        code, kbd, samp {
            font-family: monospace, monospace;
            font-size: 1em
        }

        small {
            font-size: 80%
        }

        sub, sup {
            font-size: 75%;
            line-height: 0;
            position: relative;
            vertical-align: baseline
        }

        sub {
            bottom: -0.25em
        }

        sup {
            top: -0.5em
        }

        img {
            border-style: none
        }

        button, input, optgroup, select, textarea {
            font-family: inherit;
            font-size: 100%;
            line-height: 1.15;
            margin: 0
        }

        button, input {
            overflow: visible
        }

        button, select {
            text-transform: none
        }

        button, [type="button"], [type="reset"], [type="submit"] {
            -webkit-appearance: button
        }

        button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner {
            border-style: none;
            padding: 0
        }

        button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring {
            outline: 1px dotted ButtonText
        }

        fieldset {
            padding: 0.35em 0.75em 0.625em
        }

        legend {
            box-sizing: border-box;
            color: inherit;
            display: table;
            max-width: 100%;
            padding: 0;
            white-space: normal
        }

        progress {
            vertical-align: baseline
        }

        textarea {
            overflow: auto
        }

        [type="checkbox"], [type="radio"] {
            box-sizing: border-box;
            padding: 0
        }

        [type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button {
            height: auto
        }

        [type="search"] {
            -webkit-appearance: textfield;
            outline-offset: -2px
        }

        [type="search"]::-webkit-search-decoration {
            -webkit-appearance: none
        }

        ::-webkit-file-upload-button {
            -webkit-appearance: button;
            font: inherit
        }

        details {
            display: block
        }

        summary {
            display: list-item
        }

        template {
            display: none
        }

        [hidden] {
            display: none
        }

        body, h1, h2, h3, h4, h5, h6, p, blockquote, pre, dl, dd, ol, ul, fieldset, legend, figure, hr {
            margin: 0;
            padding: 0
        }

        li > ul, li > ol {
            margin-bottom: 0
        }

        table {
            border-collapse: collapse;
            border-spacing: 0
        }

        h1, h2, h3, h4, h5, h6, ul, ol, dl, blockquote, p, address, hr, table, fieldset, figure, pre {
            margin-bottom: 32px
        }

        ul, ol, dd {
            margin-left: 16px
        }

        ul li, ol li {
            margin-bottom: 10px
        }

        .highlight {
            margin-bottom: 32px;
            background: var(--syntax-highlighting-background)
        }

        .highlighter-rouge .highlight {
            background: var(--syntax-highlighting-background)
        }

        .highlight .c {
            color: #998;
            font-style: italic
        }

        .highlight .err {
            color: #a61717;
            background-color: #e3d2d2
        }

        .highlight .k {
            font-weight: bold
        }

        .highlight .o {
            font-weight: bold
        }

        .highlight .cm {
            color: #998;
            font-style: italic
        }

        .highlight .cp {
            color: #999;
            font-weight: bold
        }

        .highlight .c1 {
            color: #998;
            font-style: italic
        }

        .highlight .cs {
            color: #999;
            font-weight: bold;
            font-style: italic
        }

        .highlight .gd {
            color: #000;
            background-color: #fdd
        }

        .highlight .gd .x {
            color: #000;
            background-color: #faa
        }

        .highlight .ge {
            font-style: italic
        }

        .highlight .gr {
            color: #a00
        }

        .highlight .gh {
            color: #999
        }

        .highlight .gi {
            color: #000;
            background-color: #dfd
        }

        .highlight .gi .x {
            color: #000;
            background-color: #afa
        }

        .highlight .go {
            color: #888
        }

        .highlight .gp {
            color: #555
        }

        .highlight .gs {
            font-weight: bold
        }

        .highlight .gu {
            color: #aaa
        }

        .highlight .gt {
            color: #a00
        }

        .highlight .kc {
            font-weight: bold
        }

        .highlight .kd {
            font-weight: bold
        }

        .highlight .kp {
            font-weight: bold
        }

        .highlight .kr {
            font-weight: bold
        }

        .highlight .kt {
            color: #5d76bf;
            font-weight: bold
        }

        .highlight .m {
            color: #099
        }

        .highlight .s {
            color: #ec2355
        }

        .highlight .na {
            color: #008080
        }

        .highlight .nb {
            color: #0086B3
        }

        .highlight .nc {
            color: #5d76bf;
            font-weight: bold
        }

        .highlight .no {
            color: #008080
        }

        .highlight .ni {
            color: #800080
        }

        .highlight .ne {
            color: #900;
            font-weight: bold
        }

        .highlight .nf {
            color: #900;
            font-weight: bold
        }

        .highlight .nn {
            color: #555
        }

        .highlight .nt {
            color: #4d65dc
        }

        .highlight .nv {
            color: #008080
        }

        .highlight .ow {
            font-weight: bold
        }

        .highlight .w {
            color: #bbb
        }

        .highlight .mf {
            color: #099
        }

        .highlight .mh {
            color: #099
        }

        .highlight .mi {
            color: #099
        }

        .highlight .mo {
            color: #099
        }

        .highlight .sb {
            color: #ec2355
        }

        .highlight .sc {
            color: #ec2355
        }

        .highlight .sd {
            color: #ec2355
        }

        .highlight .s2 {
            color: #ec2355
        }

        .highlight .se {
            color: #ec2355
        }

        .highlight .sh {
            color: #ec2355
        }

        .highlight .si {
            color: #ec2355
        }

        .highlight .sx {
            color: #ec2355
        }

        .highlight .sr {
            color: #009926
        }

        .highlight .s1 {
            color: #ec2355
        }

        .highlight .ss {
            color: #990073
        }

        .highlight .bp {
            color: #999
        }

        .highlight .vc {
            color: #008080
        }

        .highlight .vg {
            color: #008080
        }

        .highlight .vi {
            color: #008080
        }

        .highlight .il {
            color: #099
        }

        .container {
            max-width: 1140px;
            padding-left: 16px;
            padding-right: 16px;
            margin: 0 auto
        }

        @media only screen and (max-width: 1140px) {
            .container {
                max-width: 1000px
            }
        }

        @media only screen and (max-width: 1024px) {
            .container {
                max-width: 740px
            }
        }

        @media only screen and (max-width: 768px) {
            .container {
                max-width: 560px
            }
        }

        @media only screen and (max-width: 576px) {
            .container {
                max-width: 480px;
                padding-left: calc(16px + 4px);
                padding-right: calc(16px + 4px)
            }
        }

        .row {
            display: flex;
            flex-wrap: wrap;
            flex: 0 1 auto;
            flex-direction: row;
            box-sizing: border-box;
            margin-left: -16px;
            margin-right: -16px
        }

        .col {
            padding-left: 16px;
            padding-right: 16px
        }

        [class^="col-"] {
            flex: auto
        }

        .col-0 {
            width: 0%
        }

        .col-1 {
            width: 8.3333333333%
        }

        .col-2 {
            width: 16.6666666667%
        }

        .col-3 {
            width: 25%
        }

        .col-4 {
            width: 33.3333333333%
        }

        .col-5 {
            width: 41.6666666667%
        }

        .col-6 {
            width: 50%
        }

        .col-7 {
            width: 58.3333333333%
        }

        .col-8 {
            width: 66.6666666667%
        }

        .col-9 {
            width: 75%
        }

        .col-10 {
            width: 83.3333333333%
        }

        .col-11 {
            width: 91.6666666667%
        }

        .col-12 {
            width: 100%
        }

        .push-0 {
            margin-left: 0%
        }

        .push-1 {
            margin-left: 8.3333333333%
        }

        .push-2 {
            margin-left: 16.6666666667%
        }

        .push-3 {
            margin-left: 25%
        }

        .push-4 {
            margin-left: 33.3333333333%
        }

        .push-5 {
            margin-left: 41.6666666667%
        }

        .push-6 {
            margin-left: 50%
        }

        .push-7 {
            margin-left: 58.3333333333%
        }

        .push-8 {
            margin-left: 66.6666666667%
        }

        .push-9 {
            margin-left: 75%
        }

        .push-10 {
            margin-left: 83.3333333333%
        }

        .push-11 {
            margin-left: 91.6666666667%
        }

        .push-12 {
            margin-left: 100%
        }

        .pull-0 {
            margin-right: 0%
        }

        .pull-1 {
            margin-right: 8.3333333333%
        }

        .pull-2 {
            margin-right: 16.6666666667%
        }

        .pull-3 {
            margin-right: 25%
        }

        .pull-4 {
            margin-right: 33.3333333333%
        }

        .pull-5 {
            margin-right: 41.6666666667%
        }

        .pull-6 {
            margin-right: 50%
        }

        .pull-7 {
            margin-right: 58.3333333333%
        }

        .pull-8 {
            margin-right: 66.6666666667%
        }

        .pull-9 {
            margin-right: 75%
        }

        .pull-10 {
            margin-right: 83.3333333333%
        }

        .pull-11 {
            margin-right: 91.6666666667%
        }

        .pull-12 {
            margin-right: 100%
        }

        @media (max-width: 1024px) {
            .col-d-0 {
                width: 0%
            }

            .col-d-1 {
                width: 8.3333333333%
            }

            .col-d-2 {
                width: 16.6666666667%
            }

            .col-d-3 {
                width: 25%
            }

            .col-d-4 {
                width: 33.3333333333%
            }

            .col-d-5 {
                width: 41.6666666667%
            }

            .col-d-6 {
                width: 50%
            }

            .col-d-7 {
                width: 58.3333333333%
            }

            .col-d-8 {
                width: 66.6666666667%
            }

            .col-d-9 {
                width: 75%
            }

            .col-d-10 {
                width: 83.3333333333%
            }

            .col-d-11 {
                width: 91.6666666667%
            }

            .col-d-12 {
                width: 100%
            }

            .push-d-0 {
                margin-left: 0%
            }

            .push-d-1 {
                margin-left: 8.3333333333%
            }

            .push-d-2 {
                margin-left: 16.6666666667%
            }

            .push-d-3 {
                margin-left: 25%
            }

            .push-d-4 {
                margin-left: 33.3333333333%
            }

            .push-d-5 {
                margin-left: 41.6666666667%
            }

            .push-d-6 {
                margin-left: 50%
            }

            .push-d-7 {
                margin-left: 58.3333333333%
            }

            .push-d-8 {
                margin-left: 66.6666666667%
            }

            .push-d-9 {
                margin-left: 75%
            }

            .push-d-10 {
                margin-left: 83.3333333333%
            }

            .push-d-11 {
                margin-left: 91.6666666667%
            }

            .push-d-12 {
                margin-left: 100%
            }

            .pull-d-0 {
                margin-right: 0%
            }

            .pull-d-1 {
                margin-right: 8.3333333333%
            }

            .pull-d-2 {
                margin-right: 16.6666666667%
            }

            .pull-d-3 {
                margin-right: 25%
            }

            .pull-d-4 {
                margin-right: 33.3333333333%
            }

            .pull-d-5 {
                margin-right: 41.6666666667%
            }

            .pull-d-6 {
                margin-right: 50%
            }

            .pull-d-7 {
                margin-right: 58.3333333333%
            }

            .pull-d-8 {
                margin-right: 66.6666666667%
            }

            .pull-d-9 {
                margin-right: 75%
            }

            .pull-d-10 {
                margin-right: 83.3333333333%
            }

            .pull-d-11 {
                margin-right: 91.6666666667%
            }

            .pull-d-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 768px) {
            .col-t-0 {
                width: 0%
            }

            .col-t-1 {
                width: 8.3333333333%
            }

            .col-t-2 {
                width: 16.6666666667%
            }

            .col-t-3 {
                width: 25%
            }

            .col-t-4 {
                width: 33.3333333333%
            }

            .col-t-5 {
                width: 41.6666666667%
            }

            .col-t-6 {
                width: 50%
            }

            .col-t-7 {
                width: 58.3333333333%
            }

            .col-t-8 {
                width: 66.6666666667%
            }

            .col-t-9 {
                width: 75%
            }

            .col-t-10 {
                width: 83.3333333333%
            }

            .col-t-11 {
                width: 91.6666666667%
            }

            .col-t-12 {
                width: 100%
            }

            .push-t-0 {
                margin-left: 0%
            }

            .push-t-1 {
                margin-left: 8.3333333333%
            }

            .push-t-2 {
                margin-left: 16.6666666667%
            }

            .push-t-3 {
                margin-left: 25%
            }

            .push-t-4 {
                margin-left: 33.3333333333%
            }

            .push-t-5 {
                margin-left: 41.6666666667%
            }

            .push-t-6 {
                margin-left: 50%
            }

            .push-t-7 {
                margin-left: 58.3333333333%
            }

            .push-t-8 {
                margin-left: 66.6666666667%
            }

            .push-t-9 {
                margin-left: 75%
            }

            .push-t-10 {
                margin-left: 83.3333333333%
            }

            .push-t-11 {
                margin-left: 91.6666666667%
            }

            .push-t-12 {
                margin-left: 100%
            }

            .pull-t-0 {
                margin-right: 0%
            }

            .pull-t-1 {
                margin-right: 8.3333333333%
            }

            .pull-t-2 {
                margin-right: 16.6666666667%
            }

            .pull-t-3 {
                margin-right: 25%
            }

            .pull-t-4 {
                margin-right: 33.3333333333%
            }

            .pull-t-5 {
                margin-right: 41.6666666667%
            }

            .pull-t-6 {
                margin-right: 50%
            }

            .pull-t-7 {
                margin-right: 58.3333333333%
            }

            .pull-t-8 {
                margin-right: 66.6666666667%
            }

            .pull-t-9 {
                margin-right: 75%
            }

            .pull-t-10 {
                margin-right: 83.3333333333%
            }

            .pull-t-11 {
                margin-right: 91.6666666667%
            }

            .pull-t-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 576px) {
            .col-m-0 {
                width: 0%
            }

            .col-m-1 {
                width: 8.3333333333%
            }

            .col-m-2 {
                width: 16.6666666667%
            }

            .col-m-3 {
                width: 25%
            }

            .col-m-4 {
                width: 33.3333333333%
            }

            .col-m-5 {
                width: 41.6666666667%
            }

            .col-m-6 {
                width: 50%
            }

            .col-m-7 {
                width: 58.3333333333%
            }

            .col-m-8 {
                width: 66.6666666667%
            }

            .col-m-9 {
                width: 75%
            }

            .col-m-10 {
                width: 83.3333333333%
            }

            .col-m-11 {
                width: 91.6666666667%
            }

            .col-m-12 {
                width: 100%
            }

            .push-m-0 {
                margin-left: 0%
            }

            .push-m-1 {
                margin-left: 8.3333333333%
            }

            .push-m-2 {
                margin-left: 16.6666666667%
            }

            .push-m-3 {
                margin-left: 25%
            }

            .push-m-4 {
                margin-left: 33.3333333333%
            }

            .push-m-5 {
                margin-left: 41.6666666667%
            }

            .push-m-6 {
                margin-left: 50%
            }

            .push-m-7 {
                margin-left: 58.3333333333%
            }

            .push-m-8 {
                margin-left: 66.6666666667%
            }

            .push-m-9 {
                margin-left: 75%
            }

            .push-m-10 {
                margin-left: 83.3333333333%
            }

            .push-m-11 {
                margin-left: 91.6666666667%
            }

            .push-m-12 {
                margin-left: 100%
            }

            .pull-m-0 {
                margin-right: 0%
            }

            .pull-m-1 {
                margin-right: 8.3333333333%
            }

            .pull-m-2 {
                margin-right: 16.6666666667%
            }

            .pull-m-3 {
                margin-right: 25%
            }

            .pull-m-4 {
                margin-right: 33.3333333333%
            }

            .pull-m-5 {
                margin-right: 41.6666666667%
            }

            .pull-m-6 {
                margin-right: 50%
            }

            .pull-m-7 {
                margin-right: 58.3333333333%
            }

            .pull-m-8 {
                margin-right: 66.6666666667%
            }

            .pull-m-9 {
                margin-right: 75%
            }

            .pull-m-10 {
                margin-right: 83.3333333333%
            }

            .pull-m-11 {
                margin-right: 91.6666666667%
            }

            .pull-m-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 1024px) {
            .col-d-0 {
                width: 0%
            }

            .col-d-1 {
                width: 8.3333333333%
            }

            .col-d-2 {
                width: 16.6666666667%
            }

            .col-d-3 {
                width: 25%
            }

            .col-d-4 {
                width: 33.3333333333%
            }

            .col-d-5 {
                width: 41.6666666667%
            }

            .col-d-6 {
                width: 50%
            }

            .col-d-7 {
                width: 58.3333333333%
            }

            .col-d-8 {
                width: 66.6666666667%
            }

            .col-d-9 {
                width: 75%
            }

            .col-d-10 {
                width: 83.3333333333%
            }

            .col-d-11 {
                width: 91.6666666667%
            }

            .col-d-12 {
                width: 100%
            }

            .push-d-0 {
                margin-left: 0%
            }

            .push-d-1 {
                margin-left: 8.3333333333%
            }

            .push-d-2 {
                margin-left: 16.6666666667%
            }

            .push-d-3 {
                margin-left: 25%
            }

            .push-d-4 {
                margin-left: 33.3333333333%
            }

            .push-d-5 {
                margin-left: 41.6666666667%
            }

            .push-d-6 {
                margin-left: 50%
            }

            .push-d-7 {
                margin-left: 58.3333333333%
            }

            .push-d-8 {
                margin-left: 66.6666666667%
            }

            .push-d-9 {
                margin-left: 75%
            }

            .push-d-10 {
                margin-left: 83.3333333333%
            }

            .push-d-11 {
                margin-left: 91.6666666667%
            }

            .push-d-12 {
                margin-left: 100%
            }

            .pull-d-0 {
                margin-right: 0%
            }

            .pull-d-1 {
                margin-right: 8.3333333333%
            }

            .pull-d-2 {
                margin-right: 16.6666666667%
            }

            .pull-d-3 {
                margin-right: 25%
            }

            .pull-d-4 {
                margin-right: 33.3333333333%
            }

            .pull-d-5 {
                margin-right: 41.6666666667%
            }

            .pull-d-6 {
                margin-right: 50%
            }

            .pull-d-7 {
                margin-right: 58.3333333333%
            }

            .pull-d-8 {
                margin-right: 66.6666666667%
            }

            .pull-d-9 {
                margin-right: 75%
            }

            .pull-d-10 {
                margin-right: 83.3333333333%
            }

            .pull-d-11 {
                margin-right: 91.6666666667%
            }

            .pull-d-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 768px) {
            .col-t-0 {
                width: 0%
            }

            .col-t-1 {
                width: 8.3333333333%
            }

            .col-t-2 {
                width: 16.6666666667%
            }

            .col-t-3 {
                width: 25%
            }

            .col-t-4 {
                width: 33.3333333333%
            }

            .col-t-5 {
                width: 41.6666666667%
            }

            .col-t-6 {
                width: 50%
            }

            .col-t-7 {
                width: 58.3333333333%
            }

            .col-t-8 {
                width: 66.6666666667%
            }

            .col-t-9 {
                width: 75%
            }

            .col-t-10 {
                width: 83.3333333333%
            }

            .col-t-11 {
                width: 91.6666666667%
            }

            .col-t-12 {
                width: 100%
            }

            .push-t-0 {
                margin-left: 0%
            }

            .push-t-1 {
                margin-left: 8.3333333333%
            }

            .push-t-2 {
                margin-left: 16.6666666667%
            }

            .push-t-3 {
                margin-left: 25%
            }

            .push-t-4 {
                margin-left: 33.3333333333%
            }

            .push-t-5 {
                margin-left: 41.6666666667%
            }

            .push-t-6 {
                margin-left: 50%
            }

            .push-t-7 {
                margin-left: 58.3333333333%
            }

            .push-t-8 {
                margin-left: 66.6666666667%
            }

            .push-t-9 {
                margin-left: 75%
            }

            .push-t-10 {
                margin-left: 83.3333333333%
            }

            .push-t-11 {
                margin-left: 91.6666666667%
            }

            .push-t-12 {
                margin-left: 100%
            }

            .pull-t-0 {
                margin-right: 0%
            }

            .pull-t-1 {
                margin-right: 8.3333333333%
            }

            .pull-t-2 {
                margin-right: 16.6666666667%
            }

            .pull-t-3 {
                margin-right: 25%
            }

            .pull-t-4 {
                margin-right: 33.3333333333%
            }

            .pull-t-5 {
                margin-right: 41.6666666667%
            }

            .pull-t-6 {
                margin-right: 50%
            }

            .pull-t-7 {
                margin-right: 58.3333333333%
            }

            .pull-t-8 {
                margin-right: 66.6666666667%
            }

            .pull-t-9 {
                margin-right: 75%
            }

            .pull-t-10 {
                margin-right: 83.3333333333%
            }

            .pull-t-11 {
                margin-right: 91.6666666667%
            }

            .pull-t-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 576px) {
            .col-m-0 {
                width: 0%
            }

            .col-m-1 {
                width: 8.3333333333%
            }

            .col-m-2 {
                width: 16.6666666667%
            }

            .col-m-3 {
                width: 25%
            }

            .col-m-4 {
                width: 33.3333333333%
            }

            .col-m-5 {
                width: 41.6666666667%
            }

            .col-m-6 {
                width: 50%
            }

            .col-m-7 {
                width: 58.3333333333%
            }

            .col-m-8 {
                width: 66.6666666667%
            }

            .col-m-9 {
                width: 75%
            }

            .col-m-10 {
                width: 83.3333333333%
            }

            .col-m-11 {
                width: 91.6666666667%
            }

            .col-m-12 {
                width: 100%
            }

            .push-m-0 {
                margin-left: 0%
            }

            .push-m-1 {
                margin-left: 8.3333333333%
            }

            .push-m-2 {
                margin-left: 16.6666666667%
            }

            .push-m-3 {
                margin-left: 25%
            }

            .push-m-4 {
                margin-left: 33.3333333333%
            }

            .push-m-5 {
                margin-left: 41.6666666667%
            }

            .push-m-6 {
                margin-left: 50%
            }

            .push-m-7 {
                margin-left: 58.3333333333%
            }

            .push-m-8 {
                margin-left: 66.6666666667%
            }

            .push-m-9 {
                margin-left: 75%
            }

            .push-m-10 {
                margin-left: 83.3333333333%
            }

            .push-m-11 {
                margin-left: 91.6666666667%
            }

            .push-m-12 {
                margin-left: 100%
            }

            .pull-m-0 {
                margin-right: 0%
            }

            .pull-m-1 {
                margin-right: 8.3333333333%
            }

            .pull-m-2 {
                margin-right: 16.6666666667%
            }

            .pull-m-3 {
                margin-right: 25%
            }

            .pull-m-4 {
                margin-right: 33.3333333333%
            }

            .pull-m-5 {
                margin-right: 41.6666666667%
            }

            .pull-m-6 {
                margin-right: 50%
            }

            .pull-m-7 {
                margin-right: 58.3333333333%
            }

            .pull-m-8 {
                margin-right: 66.6666666667%
            }

            .pull-m-9 {
                margin-right: 75%
            }

            .pull-m-10 {
                margin-right: 83.3333333333%
            }

            .pull-m-11 {
                margin-right: 91.6666666667%
            }

            .pull-m-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 1024px) {
            .col-d-0 {
                width: 0%
            }

            .col-d-1 {
                width: 8.3333333333%
            }

            .col-d-2 {
                width: 16.6666666667%
            }

            .col-d-3 {
                width: 25%
            }

            .col-d-4 {
                width: 33.3333333333%
            }

            .col-d-5 {
                width: 41.6666666667%
            }

            .col-d-6 {
                width: 50%
            }

            .col-d-7 {
                width: 58.3333333333%
            }

            .col-d-8 {
                width: 66.6666666667%
            }

            .col-d-9 {
                width: 75%
            }

            .col-d-10 {
                width: 83.3333333333%
            }

            .col-d-11 {
                width: 91.6666666667%
            }

            .col-d-12 {
                width: 100%
            }

            .push-d-0 {
                margin-left: 0%
            }

            .push-d-1 {
                margin-left: 8.3333333333%
            }

            .push-d-2 {
                margin-left: 16.6666666667%
            }

            .push-d-3 {
                margin-left: 25%
            }

            .push-d-4 {
                margin-left: 33.3333333333%
            }

            .push-d-5 {
                margin-left: 41.6666666667%
            }

            .push-d-6 {
                margin-left: 50%
            }

            .push-d-7 {
                margin-left: 58.3333333333%
            }

            .push-d-8 {
                margin-left: 66.6666666667%
            }

            .push-d-9 {
                margin-left: 75%
            }

            .push-d-10 {
                margin-left: 83.3333333333%
            }

            .push-d-11 {
                margin-left: 91.6666666667%
            }

            .push-d-12 {
                margin-left: 100%
            }

            .pull-d-0 {
                margin-right: 0%
            }

            .pull-d-1 {
                margin-right: 8.3333333333%
            }

            .pull-d-2 {
                margin-right: 16.6666666667%
            }

            .pull-d-3 {
                margin-right: 25%
            }

            .pull-d-4 {
                margin-right: 33.3333333333%
            }

            .pull-d-5 {
                margin-right: 41.6666666667%
            }

            .pull-d-6 {
                margin-right: 50%
            }

            .pull-d-7 {
                margin-right: 58.3333333333%
            }

            .pull-d-8 {
                margin-right: 66.6666666667%
            }

            .pull-d-9 {
                margin-right: 75%
            }

            .pull-d-10 {
                margin-right: 83.3333333333%
            }

            .pull-d-11 {
                margin-right: 91.6666666667%
            }

            .pull-d-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 768px) {
            .col-t-0 {
                width: 0%
            }

            .col-t-1 {
                width: 8.3333333333%
            }

            .col-t-2 {
                width: 16.6666666667%
            }

            .col-t-3 {
                width: 25%
            }

            .col-t-4 {
                width: 33.3333333333%
            }

            .col-t-5 {
                width: 41.6666666667%
            }

            .col-t-6 {
                width: 50%
            }

            .col-t-7 {
                width: 58.3333333333%
            }

            .col-t-8 {
                width: 66.6666666667%
            }

            .col-t-9 {
                width: 75%
            }

            .col-t-10 {
                width: 83.3333333333%
            }

            .col-t-11 {
                width: 91.6666666667%
            }

            .col-t-12 {
                width: 100%
            }

            .push-t-0 {
                margin-left: 0%
            }

            .push-t-1 {
                margin-left: 8.3333333333%
            }

            .push-t-2 {
                margin-left: 16.6666666667%
            }

            .push-t-3 {
                margin-left: 25%
            }

            .push-t-4 {
                margin-left: 33.3333333333%
            }

            .push-t-5 {
                margin-left: 41.6666666667%
            }

            .push-t-6 {
                margin-left: 50%
            }

            .push-t-7 {
                margin-left: 58.3333333333%
            }

            .push-t-8 {
                margin-left: 66.6666666667%
            }

            .push-t-9 {
                margin-left: 75%
            }

            .push-t-10 {
                margin-left: 83.3333333333%
            }

            .push-t-11 {
                margin-left: 91.6666666667%
            }

            .push-t-12 {
                margin-left: 100%
            }

            .pull-t-0 {
                margin-right: 0%
            }

            .pull-t-1 {
                margin-right: 8.3333333333%
            }

            .pull-t-2 {
                margin-right: 16.6666666667%
            }

            .pull-t-3 {
                margin-right: 25%
            }

            .pull-t-4 {
                margin-right: 33.3333333333%
            }

            .pull-t-5 {
                margin-right: 41.6666666667%
            }

            .pull-t-6 {
                margin-right: 50%
            }

            .pull-t-7 {
                margin-right: 58.3333333333%
            }

            .pull-t-8 {
                margin-right: 66.6666666667%
            }

            .pull-t-9 {
                margin-right: 75%
            }

            .pull-t-10 {
                margin-right: 83.3333333333%
            }

            .pull-t-11 {
                margin-right: 91.6666666667%
            }

            .pull-t-12 {
                margin-right: 100%
            }
        }

        @media (max-width: 576px) {
            .col-m-0 {
                width: 0%
            }

            .col-m-1 {
                width: 8.3333333333%
            }

            .col-m-2 {
                width: 16.6666666667%
            }

            .col-m-3 {
                width: 25%
            }

            .col-m-4 {
                width: 33.3333333333%
            }

            .col-m-5 {
                width: 41.6666666667%
            }

            .col-m-6 {
                width: 50%
            }

            .col-m-7 {
                width: 58.3333333333%
            }

            .col-m-8 {
                width: 66.6666666667%
            }

            .col-m-9 {
                width: 75%
            }

            .col-m-10 {
                width: 83.3333333333%
            }

            .col-m-11 {
                width: 91.6666666667%
            }

            .col-m-12 {
                width: 100%
            }

            .push-m-0 {
                margin-left: 0%
            }

            .push-m-1 {
                margin-left: 8.3333333333%
            }

            .push-m-2 {
                margin-left: 16.6666666667%
            }

            .push-m-3 {
                margin-left: 25%
            }

            .push-m-4 {
                margin-left: 33.3333333333%
            }

            .push-m-5 {
                margin-left: 41.6666666667%
            }

            .push-m-6 {
                margin-left: 50%
            }

            .push-m-7 {
                margin-left: 58.3333333333%
            }

            .push-m-8 {
                margin-left: 66.6666666667%
            }

            .push-m-9 {
                margin-left: 75%
            }

            .push-m-10 {
                margin-left: 83.3333333333%
            }

            .push-m-11 {
                margin-left: 91.6666666667%
            }

            .push-m-12 {
                margin-left: 100%
            }

            .pull-m-0 {
                margin-right: 0%
            }

            .pull-m-1 {
                margin-right: 8.3333333333%
            }

            .pull-m-2 {
                margin-right: 16.6666666667%
            }

            .pull-m-3 {
                margin-right: 25%
            }

            .pull-m-4 {
                margin-right: 33.3333333333%
            }

            .pull-m-5 {
                margin-right: 41.6666666667%
            }

            .pull-m-6 {
                margin-right: 50%
            }

            .pull-m-7 {
                margin-right: 58.3333333333%
            }

            .pull-m-8 {
                margin-right: 66.6666666667%
            }

            .pull-m-9 {
                margin-right: 75%
            }

            .pull-m-10 {
                margin-right: 83.3333333333%
            }

            .pull-m-11 {
                margin-right: 91.6666666667%
            }

            .pull-m-12 {
                margin-right: 100%
            }
        }

        .animate {
            animation: animateElement cubic-bezier(0.3, 0.45, 0.45, 0.95) 0.75s;
            animation-duration: 0.5s;
            animation-iteration-count: 1;
            transition: transform .15s
        }

        @keyframes animateElement {
            0% {
                transform: translate(0px, 50px)
            }
            100% {
                transform: translate(0px, 0px)
            }
        }

        @keyframes pulse {
            0% {
                transform: scale(1, 1)
            }
            25% {
                transform: scale(1, 1)
            }
            50% {
                transform: scale(1.2, 1.2)
            }
            100% {
                transform: scale(1, 1)
            }
        }

        *, *::after, *::before {
            box-sizing: border-box
        }

        body {
            font-family: "Jost", Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 20px;
            line-height: 1.5;
            overflow-x: hidden;
            color: var(--text-color);
            background-color: var(--background-color);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale
        }

        @media only screen and (max-width: 576px) {
            body {
                font-size: 18px
            }
        }

        *::selection {
            color: var(--white);
            background-color: var(--brand-color)
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: "Jost", Helvetica Neue, Helvetica, Arial, sans-serif;
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -1px;
            color: var(--heading-font-color)
        }

        h1 {
            font-size: 36px
        }

        h2 {
            font-size: 28px
        }

        h3 {
            font-size: 24px
        }

        h4 {
            font-size: 20px
        }

        h5 {
            font-size: 18px
        }

        h6 {
            font-size: 16px
        }

        blockquote {
            position: relative;
            margin: 40px 0;
            padding-left: 26px;
            font-size: 24px;
            line-height: 1.7;
            font-weight: 900;
            border-left: 4px solid var(--brand-color);
            color: var(--heading-font-color)
        }

        blockquote p {
            margin-bottom: 10px
        }

        blockquote cite {
            display: inline-block;
            margin-top: 8px;
            font-size: 14px;
            font-weight: 700;
            font-style: normal;
            color: var(--heading-font-color)
        }

        @media only screen and (max-width: 576px) {
            blockquote {
                font-size: 21px
            }
        }

        pre {
            overflow: auto;
            padding: 15px;
            margin-bottom: 0;
            font-size: 14px;
            white-space: pre-wrap;
            word-wrap: break-word;
            word-break: break-all;
            color: var(--heading-font-color)
        }

        img, .lightense-wrap {
            max-width: 100%;
            height: auto;
            vertical-align: middle
        }

        img + em, .lightense-wrap + em, .gallery + em {
            display: block;
            margin-top: 20px;
            font-size: 12px;
            line-height: 22px;
            font-style: normal;
            font-weight: normal;
            text-align: center;
            color: var(--heading-font-color)
        }

        img + em a, .lightense-wrap + em a, .gallery + em a {
            font-weight: 500;
            border-bottom: 1px solid var(--border-color);
            transition: all 0.35s
        }

        img + em a:hover, .lightense-wrap + em a:hover, .gallery + em a:hover {
            color: var(--link-color);
            border-color: var(--link-color-hover)
        }

        @media only screen and (max-width: 576px) {
            img + em, .lightense-wrap + em, .gallery + em {
                margin-top: 12px
            }
        }

        a {
            text-decoration: none;
            color: var(--link-color);
            transition: all 0.35s
        }

        a:hover {
            color: var(--link-color-hover)
        }

        hr {
            width: 100%;
            height: 1px;
            margin: 60px 0;
            border: 0;
            background: var(--background-alt-color)
        }

        .table-container {
            display: block;
            max-width: 100%;
            overflow-x: auto
        }

        table {
            font-size: 12px;
            color: var(--dark);
            width: 100%;
            border-width: 1px;
            border-color: var(--background-alt-color);
            border-collapse: collapse;
            color: var(--heading-font-color)
        }

        table th {
            padding: 10px;
            font-size: 16px;
            text-align: left;
            border: 1px solid var(--th-color);
            color: var(--heading-font-color);
            font-weight: 700;
            background-color: var(--th-color)
        }

        table tr {
            background-color: var(--tr-color);
            transition: all .3s ease
        }

        table tr:nth-child(even) {
            background-color: transparent
        }

        table td {
            padding: 10px;
            font-size: 14px;
            border: 1px solid var(--background-alt-color)
        }

        .button {
            display: inline-block;
            padding: 20px 26px;
            font-size: 16px;
            font-weight: 700;
            text-decoration: none;
            border-radius: 2px;
            border: none;
            outline: none;
            cursor: pointer;
            transition: all .25s;
            color: var(--heading-font-color);
            background: var(--background-alt-color)
        }

        .button--primary {
            color: var(--white);
            background-color: var(--button-background-color)
        }

        .button--primary:hover {
            background: var(--button-background-hover)
        }

        .button--big {
            display: block;
            width: 100%
        }

        .lazy {
            opacity: 0;
            transition: opacity 0.3s ease-in-out
        }

        .lazy.loaded {
            opacity: 1
        }

        .lightense-backdrop {
            background-color: var(--background-color) !important
        }

        .header .header__inner {
            position: relative;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            padding: 44px 16px
        }

        @media only screen and (max-width: 1024px) {
            .header .header__inner {
                padding: 40px 16px
            }
        }

        @media only screen and (max-width: 576px) {
            .header .header__inner {
                padding: 32px 16px
            }
        }

        .logo__link {
            padding: 4px 0;
            font-family: "Jost", Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 28px;
            letter-spacing: -1px;
            line-height: 1;
            font-weight: 700;
            transition: color .25s ease
        }

        .logo__link:hover {
            color: var(--brand-color)
        }

        .logo__image {
            max-height: 50px
        }

        .main-nav {
            margin-left: auto
        }

        @media only screen and (max-width: 1024px) {
            .main-nav {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                z-index: 100;
                opacity: 0;
                visibility: hidden;
                background-color: var(--background-color)
            }

            .main-nav.is-open {
                opacity: 1;
                visibility: visible;
                transition: all .25s ease
            }

            .main-nav .nav__list {
                flex-direction: column;
                width: 100%
            }

            .main-nav .nav__list .nav__item {
                display: block;
                margin: 0
            }

            .main-nav .nav__list .nav__item.nav__item-icon {
                margin-right: 0
            }

            .main-nav .nav__list .nav__item .nav__link {
                display: inline-block;
                padding: 16px 0;
                font-size: 18px;
                transition: color .25s ease
            }

            .main-nav .nav__list .nav__item .nav__link:hover {
                color: var(--brand-color)
            }
        }

        .main-nav__box {
            display: flex;
            align-items: center
        }

        .main-nav__box .nav__icon-close {
            display: none;
            justify-content: center;
            align-items: center;
            width: 36px;
            height: 36px;
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            color: var(--heading-font-color);
            background: var(--background-alt-color);
            cursor: pointer
        }

        .main-nav__box .nav__icon-close:hover .ion-md-close {
            transform: rotate(90deg)
        }

        .main-nav__box .nav__icon-close .ion-md-close {
            transition: all 0.35s
        }

        .main-nav__box .nav__title {
            display: none
        }

        @media only screen and (max-width: 1024px) {
            .main-nav__box {
                display: block;
                align-items: center;
                width: 80%;
                height: 80vh;
                padding-top: 180px;
                margin: 0 auto;
                text-align: center;
                overflow-y: auto
            }

            .main-nav__box .nav__icon-close {
                display: flex;
                position: absolute;
                top: 40px;
                right: 40px
            }

            .main-nav__box .nav__title {
                display: inline-block;
                margin-bottom: 12px;
                font-family: "Jost", Helvetica Neue, Helvetica, Arial, sans-serif;
                font-size: 36px;
                font-weight: 700;
                letter-spacing: -1px;
                color: var(--heading-font-color)
            }
        }

        @media only screen and (max-width: 768px) {
            .main-nav__box {
                padding-top: 100px
            }
        }

        .nav__list {
            display: flex;
            align-items: center
        }

        .nav__list .nav__item {
            display: inline-block;
            margin-right: 48px;
            margin-bottom: 0
        }

        .nav__list .nav__item.nav__item-icon {
            margin-right: 12px
        }

        .nav__list .nav__item .nav__link {
            position: relative;
            padding: 4px 0;
            font-size: 16px;
            line-height: 1;
            font-weight: 700;
            transition: color .25s ease
        }

        .nav__list .nav__item .nav__link:hover {
            color: var(--brand-color)
        }

        .nav-button {
            font-size: 21px;
            color: var(--link-color);
            cursor: pointer
        }

        .nav-button .icon__menu {
            display: none;
            margin-right: 12px
        }

        .nav-button .icon__menu, .nav-button .icon__search {
            transition: color .25s ease
        }

        .nav-button .icon__menu:hover, .nav-button .icon__search:hover {
            color: var(--brand-color)
        }

        @media only screen and (max-width: 1024px) {
            .nav-button {
                display: flex;
                align-items: center;
                margin-left: auto;
                font-size: 24px
            }

            .nav-button .icon__menu {
                display: block
            }
        }

        .toggle-theme {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            width: 24px;
            height: 24px;
            user-select: none;
            cursor: pointer
        }

        @media only screen and (max-width: 1024px) {
            .toggle-theme {
                padding: 20px 0
            }
        }

        .toggle-sun, .toggle-moon {
            position: absolute;
            font-size: 20px;
            transition: color .25s ease;
            color: var(--heading-font-color)
        }

        .toggle-sun:hover, .toggle-moon:hover {
            color: var(--brand-color)
        }

        .toggle-sun {
            display: none
        }

        .dark-mode .toggle-sun {
            display: block
        }

        .dark-mode .toggle-moon {
            display: none
        }

        .search {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: -1;
            overflow: auto;
            opacity: 0;
            background: var(--background-color);
            transition: all .25s ease
        }

        .search.is-visible {
            z-index: 100;
            opacity: 1;
            transition: all .25s ease
        }

        .search__box {
            max-width: 540px;
            margin: 0 auto;
            padding-top: 120px
        }

        @media only screen and (max-width: 1024px) {
            .search__box {
                padding-top: 100px
            }
        }

        .search__group {
            position: relative;
            margin-bottom: 48px
        }

        .search__group .search__close {
            position: absolute;
            right: 28px;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            font-size: 24px;
            line-height: 1;
            border-radius: 50%;
            color: var(--heading-font-color);
            cursor: pointer;
            will-change: transform;
            transition: all .25s;
            background: var(--background-color)
        }

        .search__group .search__close:hover {
            transform: translateY(-50%) rotate(90deg)
        }

        .search__group .search__close .ion-md-close {
            vertical-align: middle
        }

        .search__group .search__text {
            width: 100%;
            padding: 28px;
            font-size: 20px;
            font-weight: 700;
            line-height: 24px;
            border: 2px solid transparent;
            border-radius: 2px;
            color: var(--heading-font-color);
            background-color: var(--background-alt-color);
            outline: 0;
            transition: all .25s
        }

        .search__group .search__text::placeholder {
            font-weight: 700;
            color: var(--heading-font-color)
        }

        .search__group .search__text:focus {
            border-color: var(--brand-color)
        }

        .search__group .search__text::-ms-clear {
            display: none
        }

        @media only screen and (max-width: 576px) {
            .search__group {
                margin-bottom: 32px
            }

            .search__group .search__text {
                padding: 24px
            }
        }

        .search-results-list .no-results {
            width: 100%;
            margin: 0;
            text-align: center;
            color: var(--heading-font-color)
        }

        .pagination {
            margin-bottom: 80px
        }

        @media only screen and (max-width: 576px) {
            .pagination {
                margin-bottom: 60px
            }
        }

        .pagination__inner {
            display: flex;
            justify-content: center;
            align-items: center
        }

        .pagination__list {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            font-size: 18px;
            font-weight: 700;
            line-height: 1;
            color: var(--text-color)
        }

        @media only screen and (max-width: 576px) {
            .pagination__list {
                align-items: stretch;
                font-size: 16px
            }
        }

        .pagination__item {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            padding: 24px 20px;
            text-align: center;
            border-radius: 8px;
            background: var(--background-alt-color)
        }

        @media only screen and (max-width: 576px) {
            .pagination__item {
                align-items: center;
                padding: 20px;
                border-radius: 8px
            }
        }

        .pagination__count {
            margin: 0 32px;
            font-size: 16px;
            color: var(--link-color)
        }

        @media only screen and (max-width: 768px) {
            .pagination__count {
                margin: 0 12px
            }
        }

        @media only screen and (max-width: 576px) {
            .pagination__count {
                margin: 0 8px;
                font-size: 14px;
                line-height: 1.2
            }
        }

        .pagination__next:hover, .pagination__prev:hover {
            color: var(--heading-font-color)
        }

        .pagination__next i, .pagination__prev i {
            font-size: 15px;
            transition: transform .15s ease;
            will-change: transform
        }

        .pagination__next.disabled, .pagination__prev.disabled {
            opacity: 0.64;
            cursor: not-allowed;
            color: inherit
        }

        .pagination__next.disabled:hover i, .pagination__prev.disabled:hover i {
            transform: none
        }

        .dark-mode .pagination__next.disabled, .dark-mode .pagination__prev.disabled {
            opacity: 0.78
        }

        .pagination__next:hover i {
            transform: translateX(2px)
        }

        .pagination__next i {
            margin-left: 5px
        }

        .pagination__prev:hover i {
            transform: translateX(-2px)
        }

        .pagination__prev i {
            margin-right: 5px
        }

        .footer {
            margin-top: 48px;
            background-color: var(--background-alt-color)
        }

        @media only screen and (max-width: 576px) {
            .footer {
                margin-top: 60px
            }
        }

        .footer__inner {
            padding: 80px 0
        }

        .footer__inner .row .col {
            flex-grow: 1
        }

        @media only screen and (max-width: 576px) {
            .footer__inner {
                padding: 60px 0
            }
        }

        @media only screen and (max-width: 1024px) {
            .footer__author {
                margin-bottom: 60px
            }
        }

        @media only screen and (max-width: 576px) {
            .footer__author {
                margin-bottom: 40px
            }
        }

        .footer__author-avatar {
            position: relative;
            width: 105px;
            height: 105px;
            margin-bottom: 20px;
            transform: translate(0);
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0px 100px 80px rgba(0, 0, 0, 0.07), 0px 12.5216px 10.0172px rgba(0, 0, 0, 0.035);
            background-color: var(--background-color)
        }

        .footer__author-avatar img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none
        }

        .footer__author-name {
            margin-bottom: 20px;
            font-size: 32px;
            font-weight: 900;
            line-height: 1
        }

        .footer__author-bio {
            margin-bottom: 0;
            color: var(--text-alt-color)
        }

        .social {
            margin-top: 16px
        }

        .social .social__list {
            display: flex;
            align-items: center;
            flex-wrap: wrap
        }

        .social .social__list .social__item:first-child > .social__link {
            padding-left: 0
        }

        .social .social__item {
            margin-bottom: 0;
            margin-right: 16px
        }

        .social .social__item:last-child {
            margin-right: 0
        }

        .footer__gallery .footer__gallery-title {
            margin-bottom: 24px;
            font-size: 28px
        }

        .footer__gallery .gallery__image img {
            height: 100%;
            border-radius: 8px;
            overflow: hidden
        }

        .footer__gallery .gallery__image img.lightense-open {
            border-radius: 0
        }

        .footer__info {
            padding: 44px 0;
            background-color: var(--background-color)
        }

        .footer__info .footer__info-box {
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        @media only screen and (max-width: 1024px) {
            .footer__info {
                padding: 40px 0
            }
        }

        .copyright {
            margin-right: 20px;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-alt-color)
        }

        .copyright a {
            text-decoration: underline;
            text-decoration-color: transparent;
            color: var(--heading-font-color)
        }

        .copyright a:hover {
            text-decoration-color: var(--heading-font-color);
            color: var(--heading-font-color)
        }

        .top {
            min-width: 36px;
            height: 36px;
            font-size: 20px;
            line-height: 36px;
            text-align: center;
            border-radius: 8px;
            color: var(--heading-font-color);
            background-color: var(--background-alt-color);
            cursor: pointer;
            transition: all .25s ease
        }

        .gallery-box {
            margin: 32px 0
        }

        .gallery {
            display: grid;
            grid-template-columns:repeat(3, auto);
            justify-content: center;
            align-content: center;
            grid-gap: 10px
        }

        .gallery .gallery__image {
            background: var(--background-color)
        }

        .gallery .gallery__image img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover
        }

        .hero {
            padding: 80px 0;
            margin-bottom: 80px;
            background-color: var(--background-alt-color)
        }

        @media only screen and (max-width: 576px) {
            .hero {
                padding: 60px 0;
                margin-bottom: 60px
            }
        }

        .hero__inner {
            display: flex;
            align-items: center
        }

        @media only screen and (max-width: 1024px) {
            .hero__inner {
                flex-direction: column
            }
        }

        .hero__left {
            max-width: 450px;
            margin-right: auto
        }

        @media only screen and (max-width: 1140px) {
            .hero__left {
                max-width: 440px
            }
        }

        @media only screen and (max-width: 1024px) {
            .hero__left {
                max-width: 100%
            }
        }

        .hero__title {
            margin-bottom: 20px;
            font-size: 55px;
            font-weight: 900;
            line-height: 1.3;
            color: var(--heading-font-color)
        }

        @media only screen and (max-width: 1024px) {
            .hero__title {
                font-size: 50px
            }
        }

        @media only screen and (max-width: 768px) {
            .hero__title {
                font-size: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .hero__title {
                font-size: 32px
            }
        }

        .hero__description {
            margin-bottom: 0;
            font-size: 21px;
            color: var(--text-alt-color)
        }

        @media only screen and (max-width: 1024px) {
            .hero__description {
                font-size: inherit
            }
        }

        .hero__subscribe {
            margin-top: 32px
        }

        .hero__subscribe .subscribe-form {
            position: relative;
            border-radius: 2px;
            background-color: var(--background-color)
        }

        .hero__subscribe .subscribe-email {
            width: 100%;
            height: 70px;
            padding: 20px;
            font-size: 16px;
            line-height: 21px;
            border: 2px solid transparent;
            border-radius: 2px;
            outline: 0;
            color: var(--heading-font-color);
            background-color: transparent;
            transition: all .25s ease
        }

        .hero__subscribe .subscribe-email::placeholder {
            opacity: 0.6;
            color: var(--text-alt-color)
        }

        .hero__subscribe .subscribe-email:focus {
            border-color: var(--brand-color)
        }

        .hero__subscribe .subscribe-button {
            position: absolute;
            top: 6px;
            right: 6px
        }

        @media only screen and (max-width: 1024px) {
            .hero__subscribe {
                margin-top: 24px
            }
        }

        @media only screen and (max-width: 576px) {
            .hero__subscribe {
                margin-top: 20px
            }

            .hero__subscribe .subscribe-form {
                display: flex;
                flex-direction: column;
                padding: 6px
            }

            .hero__subscribe .subscribe-email {
                height: 56px;
                margin-bottom: 4px
            }

            .hero__subscribe .subscribe-button {
                position: relative;
                top: 0;
                right: 0
            }
        }

        .hero__right {
            width: 50%
        }

        @media only screen and (max-width: 1024px) {
            .hero__right {
                width: 100%;
                margin-top: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .hero__right {
                margin-top: 32px
            }
        }

        .hero__image {
            position: relative;
            transform: translate(0);
            width: 100%;
            height: 410px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.02);
            background-color: var(--background-color);
            user-select: none
        }

        .hero__image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        @media only screen and (max-width: 1140px) {
            .hero__image {
                height: 380px
            }
        }

        @media only screen and (max-width: 1024px) {
            .hero__image {
                height: 440px
            }
        }

        @media only screen and (max-width: 768px) {
            .hero__image {
                height: 420px
            }
        }

        @media only screen and (max-width: 576px) {
            .hero__image {
                height: 280px
            }
        }

        .article {
            margin-bottom: 32px;
            will-change: transform;
            transition: transform .2s
        }

        .article:hover {
            transform: translateY(-3px)
        }

        .article:hover .article__title a {
            text-decoration: underline;
            text-decoration-color: var(--link-color-hover);
            text-decoration-thickness: 2px
        }

        .article__head {
            position: relative
        }

        .article__date {
            position: absolute;
            z-index: 1;
            top: 16px;
            left: 16px;
            display: inline-block;
            padding: 8px 12px;
            font-size: 12px;
            line-height: 1;
            font-weight: 500;
            border-radius: 4px;
            color: var(--heading-font-color);
            background: var(--background-color);
            pointer-events: none
        }

        .article__image {
            position: relative;
            transform: translate(0);
            display: block;
            height: 0;
            margin-bottom: 24px;
            padding-bottom: 62%;
            border-radius: 8px;
            overflow: hidden;
            background: var(--background-alt-color)
        }

        .article__image img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none
        }

        .video-icon {
            position: absolute;
            z-index: 1;
            top: 50%;
            left: 50%;
            width: 50%;
            height: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none
        }

        .video-icon .circle {
            width: 50px;
            height: 50px;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            overflow: hidden;
            margin: auto;
            transform: scale(1, 1)
        }

        .video-icon .circle.pulse {
            animation-timing-function: ease;
            animation: pulse 2s infinite;
            background-color: rgba(255, 255, 255, 0.25)
        }

        .video-icon svg {
            fill: rgba(255, 255, 255, 0.25);
            stroke: var(--light-blue);
            stroke-linejoin: round;
            stroke-width: 5;
            backdrop-filter: blur(3.5px);
            -webkit-backdrop-filter: blur(4.5px);
            transition: all 0.3s
        }

        .article__title {
            margin-bottom: 12px;
            font-size: 24px
        }

        .article__title a {
            text-decoration: underline;
            text-decoration-color: transparent;
            text-decoration-thickness: 2px
        }

        .article__title a:hover {
            color: var(--heading-font-color)
        }

        .article__excerpt {
            margin-bottom: 0;
            font-size: 16px;
            color: var(--text-alt-color)
        }

        .contact-head {
            margin-bottom: 32px
        }

        .form__group {
            margin-bottom: 20px
        }

        .form__group:last-child {
            margin-bottom: 0
        }

        .form__input {
            width: 100%;
            padding: 20px;
            font-size: 16px;
            font-weight: 400;
            border: 2px solid var(--border-color);
            border-radius: 2px;
            outline: 0;
            transition: .25s ease-in-out;
            resize: vertical;
            color: var(--heading-font-color);
            background-color: var(--background-alt-color)
        }

        .form__input::placeholder {
            color: var(--text-alt-color)
        }

        .form__input:focus {
            border-color: var(--brand-color)
        }

        .section__head {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-bottom: 40px
        }

        .section__head::after {
            content: "";
            position: absolute;
            z-index: -1;
            display: block;
            width: 100%;
            height: 1px;
            background: var(--background-alt-color);
            pointer-events: none
        }

        @media only screen and (max-width: 768px) {
            .section__head::after {
                content: none
            }
        }

        .section__title {
            padding-right: 20px;
            margin-bottom: 0;
            font-size: 28px
        }

        @media only screen and (max-width: 576px) {
            .section__title {
                font-size: 24px
            }
        }

        .section__link {
            padding-left: 20px;
            font-size: 18px;
            font-weight: 500;
            text-decoration: underline;
            text-decoration-color: transparent;
            color: var(--link-color);
            transition: text-decoration .35s
        }

        .section__link:hover {
            text-decoration-color: var(--heading-font-color);
            color: var(--link-color-hover)
        }

        @media only screen and (max-width: 768px) {
            .section__link {
                padding-left: 0
            }
        }

        @media only screen and (max-width: 576px) {
            .section__link {
                font-size: 16px
            }
        }

        .section__title, .section__link {
            background: var(--background-color)
        }

        @media only screen and (max-width: 576px) {
            .section-tags .row .col:last-child > .tag-image {
                margin-bottom: 0
            }
        }

        .tag-image {
            margin-bottom: 32px;
            position: relative;
            transform: translate(0);
            display: block;
            height: 0;
            padding-bottom: 62%;
            border-radius: 8px;
            overflow: hidden;
            background: var(--background-alt-color);
            transition: transform .2s
        }

        .tag-image:hover {
            transform: translateY(-3px)
        }

        .tag-image img {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none
        }

        .tag-image .tag-name {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
            max-width: 90%;
            display: inline-block;
            padding: 8px 12px;
            font-size: 14px;
            line-height: 1;
            font-weight: 700;
            text-transform: capitalize;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            border-radius: 4px;
            color: var(--heading-font-color);
            background: var(--background-color);
            pointer-events: none
        }

        .post-head, .page-head {
            margin-bottom: 48px
        }

        .post-head .row, .page-head .row {
            align-items: center
        }

        @media only screen and (max-width: 1024px) {
            .post-head, .page-head {
                margin-bottom: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .post-head, .page-head {
                margin-bottom: 32px
            }
        }

        .post-image, .page-image {
            position: relative;
            transform: translate(0);
            padding-top: 90%;
            min-height: 280px;
            border-radius: 8px;
            overflow: hidden;
            background: var(--background-alt-color)
        }

        .post-image img, .page-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none
        }

        @media only screen and (max-width: 1024px) {
            .post-image, .page-image {
                padding-top: 65%;
                margin-bottom: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .post-image, .page-image {
                margin-bottom: 32px
            }
        }

        .page-image {
            padding-top: 56.25%;
            margin-bottom: 48px
        }

        @media only screen and (max-width: 1024px) {
            .page-image {
                margin-bottom: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .page-image {
                margin-bottom: 32px
            }
        }

        .post-video, .page-video {
            margin-bottom: 48px;
            border-radius: 8px;
            overflow: hidden;
            transform: translate(0);
            background-color: var(--background-alt-color)
        }

        .post-video .post-video__wrap, .post-video .page-video__wrap, .page-video .post-video__wrap, .page-video .page-video__wrap {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%
        }

        .post-video .post-video__wrap iframe, .post-video .page-video__wrap iframe, .page-video .post-video__wrap iframe, .page-video .page-video__wrap iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%
        }

        @media only screen and (max-width: 1024px) {
            .post-video, .page-video {
                margin-bottom: 40px
            }
        }

        @media only screen and (max-width: 576px) {
            .post-video, .page-video {
                margin-bottom: 32px
            }
        }

        .post__info {
            margin-left: 44px
        }

        .post__info.post__info-video {
            max-width: 760px;
            margin: 0 auto
        }

        @media only screen and (max-width: 1024px) {
            .post__info {
                margin-left: 0
            }
        }

        .page__info {
            max-width: 760px;
            margin: 0 auto
        }

        .post__tags {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px
        }

        .post__tags .post__tag {
            padding: 12px 16px;
            margin: 4px 8px 4px 0;
            font-size: 14px;
            line-height: 1;
            font-weight: 500;
            text-transform: capitalize;
            border: none;
            border-radius: 8px;
            color: var(--heading-font-color);
            transition: none;
            background-color: var(--background-alt-color)
        }

        .post__tags .post__tag:last-child {
            margin-right: 0
        }

        @media only screen and (max-width: 576px) {
            .post__tags {
                margin-bottom: 16px
            }
        }

        .post__title, .page__title {
            margin-bottom: 24px;
            font-size: 46px;
            line-height: 1.2;
            font-weight: 900
        }

        @media only screen and (max-width: 576px) {
            .post__title, .page__title {
                margin-bottom: 20px;
                font-size: 32px
            }
        }

        .page__title {
            margin-bottom: 0
        }

        .post__meta {
            display: flex;
            align-items: center;
            line-height: 1
        }

        .post__meta .post__author-image {
            position: relative;
            transform: translate(0);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 12px;
            background-color: var(--background-alt-color)
        }

        .post__meta .post__author-image img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            user-select: none
        }

        .post__meta .post__meta-bottom {
            display: flex;
            flex-direction: column
        }

        .post__meta .post__author {
            display: inline-block;
            margin-bottom: 7px;
            font-size: 16px;
            font-weight: 500;
            text-decoration: underline;
            text-decoration-color: transparent;
            color: var(--heading-font-color);
            transition: text-decoration-color .35s
        }

        .post__meta .post__author:hover {
            text-decoration-color: var(--heading-font-color)
        }

        .post__meta .post__date {
            font-size: 14px;
            font-weight: 400;
            color: var(--text-alt-color)
        }

        .post, .page {
            max-width: 760px;
            margin: 0 auto 60px;
            color: var(--text-color)
        }

        .post a, .page a {
            font-weight: 500;
            border-bottom: 1px solid var(--border-color)
        }

        .post a:hover, .page a:hover {
            color: var(--link-color);
            border-bottom-color: var(--link-color-hover)
        }

        .post img, .post .js-reframe, .page img, .page .js-reframe {
            border-radius: 8px;
            overflow: hidden
        }

        .post img.lightense-open, .post .js-reframe.lightense-open, .page img.lightense-open, .page .js-reframe.lightense-open {
            border-radius: 0
        }

        .post img[src$='#wide'], .page img[src$='#wide'] {
            display: block;
            width: 100vw;
            max-width: none;
            margin-left: 50%;
            transform: translateX(-50%);
            border-radius: 0;
            pointer-events: none;
            user-select: none
        }

        .post .button, .page .button {
            border: none;
            text-decoration: none
        }

        .post__share .share__list {
            display: flex;
            align-items: center;
            width: 100%
        }

        .post__share .share__item {
            width: 50%;
            margin-right: 8px;
            margin-bottom: 0;
            text-align: center
        }

        .post__share .share__item:last-child {
            margin-right: 0
        }

        .post__share .share__link {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 54px;
            font-size: 18px;
            text-transform: uppercase;
            border: none;
            border-radius: 8px;
            background: var(--background-alt-color)
        }

        .post__share .share__link i {
            transition: transform .25s;
            will-change: transform
        }

        .post__share .share__link:hover {
            color: var(--heading-font-color)
        }

        .post__share .share__link:hover i {
            transform: scale(1.1)
        }

        .related-posts {
            display: none;
            margin-top: 80px
        }

        .related-posts.is-related {
            display: block
        }

        .related-posts .related-tag {
            text-transform: capitalize
        }

        @media only screen and (max-width: 576px) {
            .related-posts {
                margin-top: 60px
            }

            .related-posts .row .col:last-child {
                margin-bottom: 0
            }
        }

        .show-comments {
            margin: 48px 0 32px;
            text-align: center
        }

        .show-comments .disqus-button {
            padding: 28px;
            border-radius: 8px;
            text-decoration: underline;
            text-decoration-color: transparent
        }

        .show-comments .disqus-button:hover {
            text-decoration-color: var(--heading-font-color)
        }

        @media only screen and (max-width: 576px) {
            .show-comments {
                margin: 60px 0 0
            }

            .show-comments .disqus-button {
                padding: 24px
            }
        }

        .post__comments {
            max-width: 760px;
            margin: 0 auto
        }

        .post__comments.is-open {
            margin: 0 auto 32px
        }

        @media only screen and (max-width: 576px) {
            .post__comments.is-open {
                margin: 0 auto
            }
        }

        .error {
            text-align: center
        }

        .error .error__title {
            margin-bottom: 24px;
            font-size: 100px;
            line-height: 1
        }

        .error .error__text {
            margin-bottom: 0;
            color: var(--text-alt-color)
        }

        @media only screen and (max-width: 576px) {
            .error .error__title {
                font-size: 68px
            }
        }

        .recent-posts {
            margin-top: 80px
        }

        @media only screen and (max-width: 576px) {
            .recent-posts {
                margin-top: 60px
            }

            .recent-posts .row .col:last-child {
                margin-bottom: 0
            }
        }

        .tag__head {
            margin: 80px 0
        }

        @media only screen and (max-width: 1024px) {
            .tag__head {
                margin: 40px 0
            }
        }

        .tags__inner {
            margin-bottom: 120px
        }

        @media only screen and (max-width: 576px) {
            .tags__inner {
                margin-bottom: 60px
            }
        }

        .tag__title {
            margin-bottom: 32px;
            font-size: 46px;
            font-weight: 900
        }

        @media only screen and (max-width: 576px) {
            .tag__title {
                font-size: 32px
            }
        }

        .tag__list {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            padding-bottom: 80px;
            border-bottom: 1px solid var(--background-alt-color)
        }

        .tag__list .tag__item {
            margin-right: 12px;
            margin-bottom: 12px
        }

        .tag__list .tag__item:last-child {
            margin-right: 0
        }

        .tag__list .tag__link {
            display: block;
            padding: 12px 16px;
            font-size: 16px;
            font-weight: 500;
            text-transform: capitalize;
            border-radius: 8px;
            transition: none;
            background: var(--background-alt-color)
        }

        .tag__list .tag__link:hover {
            color: var(--heading-font-color)
        }

        @media only screen and (max-width: 576px) {
            .tag__list {
                padding-bottom: 48px
            }

            .tag__list .tag__item {
                margin-right: 8px;
                margin-bottom: 8px
            }

            .tag__list .tag__link {
                font-size: 14px
            }
        }

        .tag__info {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 4px
        }

        .tag__info::after {
            content: "";
            position: absolute;
            z-index: -1;
            display: block;
            width: 100%;
            height: 1px;
            background: var(--background-alt-color);
            pointer-events: none
        }

        @media only screen and (max-width: 576px) {
            .tag__info::after {
                content: none
            }
        }

        .tag__info-box {
            display: flex;
            align-items: center
        }

        .tag__counter {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 12px 24px;
            border-radius: 8px;
            color: var(--heading-font-color);
            background: var(--background-alt-color)
        }

        .tag__counter span {
            font-family: "Jost", Helvetica Neue, Helvetica, Arial, sans-serif;
            font-size: 32px;
            font-weight: 700;
            line-height: 1
        }

        .tag__counter small {
            font-size: 16px;
            font-weight: 500
        }

        @media only screen and (max-width: 576px) {
            .tag__counter {
                display: none
            }
        }

        .tag__name {
            padding: 50px 20px 50px 20px;
            margin-bottom: 0;
            font-size: 36px;
            text-transform: capitalize;
            background-color: var(--background-color)
        }

        .tag__name span {
            font-weight: 400;
            color: var(--text-alt-color)
        }

        @media only screen and (max-width: 768px) {
            .tag__name {
                font-size: 32px
            }
        }

        @media only screen and (max-width: 576px) {
            .tag__name {
                padding: 32px 12px 32px 0;
                font-size: 26px
            }
        }

        .top__link {
            padding-left: 20px;
            font-size: 18px;
            font-weight: 500;
            text-decoration: underline;
            text-decoration-color: transparent;
            color: var(--link-color);
            transition: text-decoration .35s;
            background: var(--background-color)
        }

        .top__link:hover {
            text-decoration-color: var(--heading-font-color);
            color: var(--link-color-hover)
        }

        @media only screen and (max-width: 576px) {
            .top__link {
                padding-left: 0;
                font-size: 16px
            }
        }

        .gradient-text {
            /* Fallback: Set a background color. */
            background-color: #CA4246;

            /* Create the gradient. */
            background-image: linear-gradient(
                    45deg,
                    #CA4246 16.666%,
                    #E16541 16.666%,
                    #E16541 33.333%,
                    #F18F43 33.333%,
                    #F18F43 50%,
                    #8B9862 50%,
                    #8B9862 66.666%,
                    #476098 66.666%,
                    #476098 83.333%,
                    #A7489B 83.333%);

            /* Set the background size and repeat properties. */
            background-size: 100%;
            background-repeat: repeat;

            /* Use the text as a mask for the background. */
            /* This will show the gradient as a text color rather than element bg. */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;

            /* Animate the text when loading the element. */
            /* This animates it on page load and when hovering out. */
            animation: rainbow-text-simple-animation-rev 0.75s ease forwards;

        }

        .gradient-text:hover{
            animation: rainbow-text-simple-animation 0.5s ease-in forwards;
        }


        /* Move the background and make it smaller. */
        /* Animation shown when entering the page and after the hover animation. */
        @keyframes rainbow-text-simple-animation-rev {
            0% {
                background-size: 650%;
            }
            40% {
                background-size: 650%;
            }
            100% {
                background-size: 100%;
            }
        }

        /* Move the background and make it larger. */
        /* Animation shown when hovering over the text. */
        @keyframes rainbow-text-simple-animation {
            0% {
                background-size: 100%;
            }
            80% {
                background-size: 650%;
            }
            100% {
                background-size: 650%;
            }
        }


    </style>
</head>

<body>


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FH2QHQYH2Y"></script>
<script>
    window.dataLayer = window.dataLayer || [];

    function gtag() {
        dataLayer.push(arguments);
    }

    gtag('js', new Date());

    gtag('config', 'G-FH2QHQYH2Y');
</script>


<!-- begin header -->
<header class="header" id="top">
    <div class="container">
        <div class="row">
            <div class="header__inner col col-12">

                <div class="logo">
                    <a class="logo__link" href="/">

                        Forter Tech Blog

                    </a>
                </div>

                <nav class="main-nav">
                    <div class="main-nav__box">
                        <div class="nav__icon-close">
                            <i class="ion ion-md-close"></i>
                        </div>
                        <div class="nav__title">Menu</div>
                        <ul class="nav__list list-reset">
                            <li class="nav__item">
                                <a href="/" class="nav__link">Home</a>
                            </li>

                            <li class="nav__item">
                                <a target="_blank" href="https://www.forter.dev" class="nav__link gradient-text">forter.dev</a>
                            </li>

                            <li class="nav__item nav__item-icon">
                                <div class="toggle-theme">
                                    <div class="toggle-moon" title="Enable dark mode"><i class="ion ion-ios-moon"></i>
                                    </div>
                                    <div class="toggle-sun" title="Enable light mode"><i class="ion ion-ios-sunny"></i>
                                    </div>
                                </div>
                            </li>

                        </ul>
                    </div>
                </nav>

                <div class="nav-button">
                    <i class="nav__icon icon__menu ion ion-md-menu"></i>
                    <i class="nav__icon icon__search ion ion-md-search"></i>
                </div>

            </div>
        </div>
    </div>
</header>
<!-- end header -->

<!-- begin search -->
<div class="search">
    <div class="container">
        <div class="row">
            <div class="col col-12">
                <div class="search__box">
                    <div class="search__group">
                        <div class="search__close">
                            <i class="ion ion-md-close"></i>
                        </div>
                        <label for="js-search-input" class="screen-reader-text">Search for Blog</label>
                        <input type="text" id="js-search-input" class="search__text" autocomplete="off"
                               placeholder="Type to search...">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row search-results-list" id="js-results-container"></div>
    </div>

</div>
<!-- end search -->

<!-- begin content -->
<main class="content" aria-label="Content">
    <div class="post-head">
        <div class="container">
            <div class="row">

                <div class="col col-6 col-d-12">
                    <div class="post-image">
                        <img class="lazy" data-src="/images/post-img/bug.jpg"
                             alt="Walkthrough: Tracking an Elasticsearch Java Client Sniffer Bug">
                    </div>
                </div>

                <div class="col col-6 col-d-12">
                    <div class="post__info ">


                        <div class="post__tags">

                            <a href="/tags#bug" class="post__tag">bug</a>
                            <a href="/tags#elasticsearch" class="post__tag">elasticsearch</a>
                            <a href="/tags#production" class="post__tag">production</a>
                            <a href="/tags#walkthrough" class="post__tag">walkthrough</a>
                            <a href="/tags#software architecture" class="post__tag">software architecture</a>

                        </div>


                        <h1 class="post__title">Walkthrough: Tracking an Elasticsearch Java Client Sniffer Bug</h1>

                        <div class="post__meta">
                            <a href="/about/" class="post__author-image">
                                <img class="lazy" data-src="/images/authors/reem.jpg" alt="Re'em Bensimhon">
                            </a>

                            <div class="post__meta-bottom">
                                <span class="post__author">Re'em Bensimhon</span>
                                <time class="post__date" datetime="2018-01-01T00:00:00+00:00">1 Jan 2018</time>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- begin post -->
    <div class="container animate">

        <article class="post">
            <div class="post__content">
                <p>&nbsp;</p>
                <p>Elasticsearch has always been good to us at Forter. It’s truly reliable. It’s damn good at searching, and it’s a solid distributed application as well. It balances a cluster relatively quickly, and it is easy to configure and easy to backup/restore, etc., but… we were haunted by an issue which had a catastrophic effect on our system.</p>
                <p>&nbsp;</p>
                <p>The Observed Issue – Chain of Events:</p>
                <ul>
                    <li>An under-utilized ES cluster needs downscaling;</li>
                    <li>De-allocating of all shards from the nodes planned for termination via <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/allocation-filtering.html">Shard Allocation Filtering;</a></li>
                    <li>Wait for the cluster state to become “green” again;</li>
                    <li>Terminate the nodes that are now vacant;</li>
                    <li><strong>Issue</strong>: All ES operations from the Java clients freeze.</li>
                </ul>
                <p>&nbsp;</p>
                <p style="padding-left: 30px;"><strong>Some Background:</strong></p>
                <p style="padding-left: 30px;">We use Elasticsearch in a Storm topology. Storm is a Java distributed streaming framework. We use Storm to do some real-time fraud prevention, and it’s essential for business that our Storm application returns an answer in under 1 second. We use the official <a href="https://github.com/elastic/elasticsearch/blob/master/client/rest/src/main/java/org/elasticsearch/client/RestClient.java">Elasticsearch Java REST API client</a> (latest, 5.5.3) because we care about forward compatibility. The ES REST client is a wrapper around a version of &nbsp;<a href="https://hc.apache.org/httpcomponents-core-ga/tutorial/html/nio.html">Apache Async HttpClient</a> (4.1.2). Actually, due to the nature of Java and our application infrastructures, we had to migrate all of our previously HTTP blocking clients to async when we adopted the new ES REST client, so you can say that we are pretty invested.</p>
                <p>&nbsp;</p>
                <p>What do I mean by, “ES operations from the Java clients freeze,” you might ask? Well, usually when using an async HTTP client you can start a request and use a Future object to wait for the response. This waiting process happens on a separate thread to where any I/O might happen, and that really comes in handy when in need of an accurate timeout mechanism. Client-side timeouts are indeed supported in the ES REST client API via the <a href="https://github.com/elastic/elasticsearch/blob/v5.2.1/client/rest/src/main/java/org/elasticsearch/client/RestClient.java#L576">SyncResponseListener</a> class. In other words, using a SyncResponseListener object that was initialized with a 5 second timeout should guarantee that the request would take no more than 5 seconds, regardless of the cluster state. However, that is not what we were observing: Instead, we see all clients freezing completely for long periods of time the minute nodes are terminated. We expected the clients to timeout any requests to the terminated nodes after the determined timeout, having them instead freeze is terrible for our system. It’s the kind of bug we simply can’t afford to guess at in order to fix. It’s also the kind of bug that involves a nuanced interplay between at least three different processes: 2 ES nodes and a Java client.</p>
                <p>&nbsp;</p>
                <p>With no errors other than timeouts anywhere to be found, there wasn’t much for us to do short of replicating the issue locally.</p>
                <h2></h2>
                <p>&nbsp;</p>
                <h2>Reproducing Issue Locally</h2>
                <p>To replicate the issue I needed an ES cluster: 2 VBox machines running the latest Elasticsearch docker image were enough – I didn’t just use two docker containers on my machine because I wanted them to have host-network IPs (VBox bridged network adapter, no NAT involved). For the Java client I used a <a href="https://github.com/reembs/kumulus">Kumulus</a> (shameless self promotion, lightweight Storm implementation), topology with a single component: An ES client that indexes one document every second to the cluster. The ES REST client was built with sniffing and on-failure hook support.&nbsp;The client construction code looked like this:</p>
                <p>&nbsp;</p>
                <script src="https://gist.github.com/8d190ba30d8b5c9d2bdeabdfa00e1496.js?file=EsRestInit.java"></script><link rel="stylesheet" href="https://github.githubassets.com/assets/gist-embed-549f23051d8d.css"><div id="gist84712279" class="gist">
                <div class="gist-file" translate="no">
                    <div class="gist-data">
                        <div class="js-gist-file-update-container js-task-list-container file-box">
                            <div id="file-esrestinit-java" class="file my-2">

                                <div itemprop="text" class="Box-body p-0 blob-wrapper data type-java  ">


                                    <div class="js-check-bidi js-blob-code-container blob-code-content">

                                        <template class="js-file-alert-template">
                                            <div data-view-component="true" class="flash flash-warn flash-full d-flex flex-items-center">
                                                <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
                                                    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
                                                </svg>

                                                <span>
      This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
      <a href="https://github.co/hiddenchars" target="_blank">Learn more about bidirectional Unicode characters</a>
    </span>


                                                <div data-view-component="true" class="flash-action">        <a href="{{ revealButtonHref }}" data-view-component="true" class="btn-sm btn">    Show hidden characters
                                                </a>
                                                </div>
                                            </div></template>
                                        <template class="js-line-alert-template">
  <span aria-label="This line has hidden Unicode characters" data-view-component="true" class="line-alert tooltipped tooltipped-e">
    <svg aria-hidden="true" height="16" viewBox="0 0 16 16" version="1.1" width="16" data-view-component="true" class="octicon octicon-alert">
    <path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path>
</svg>
</span></template>

                                        <table data-hpc="" class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="Java" data-tagsearch-path="EsRestInit.java">
                                            <tbody><tr>
                                                <td id="file-esrestinit-java-L1" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="1"></td>
                                                <td id="file-esrestinit-java-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">SniffOnFailureListener</span> <span class="pl-s1">sniffOnFailureListener</span> = <span class="pl-k">new</span> <span class="pl-smi">SniffOnFailureListener</span>();</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L2" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="2"></td>
                                                <td id="file-esrestinit-java-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">RestClient</span> <span class="pl-s1">restClient</span> = <span class="pl-s1">RestClient</span>.<span class="pl-en">builder</span>(<span class="pl-s1">Iterables</span>.<span class="pl-en">toArray</span>(<span class="pl-s1">hosts</span>, <span class="pl-smi">HttpHost</span>.<span class="pl-s1">class</span>))</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L3" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="3"></td>
                                                <td id="file-esrestinit-java-LC3" class="blob-code blob-code-inner js-file-line">    .<span class="pl-en">setMaxRetryTimeoutMillis</span>(<span class="pl-s1">timeoutInMillis</span>)</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L4" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="4"></td>
                                                <td id="file-esrestinit-java-LC4" class="blob-code blob-code-inner js-file-line">    .<span class="pl-en">setFailureListener</span>(<span class="pl-s1">sniffOnFailureListener</span>)</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L5" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="5"></td>
                                                <td id="file-esrestinit-java-LC5" class="blob-code blob-code-inner js-file-line">    .<span class="pl-en">build</span>();</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L6" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="6"></td>
                                                <td id="file-esrestinit-java-LC6" class="blob-code blob-code-inner js-file-line"><span class="pl-smi">Sniffer</span> <span class="pl-s1">sniffer</span> = <span class="pl-s1">Sniffer</span>.<span class="pl-en">builder</span>(<span class="pl-s1">restClient</span>)</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L7" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="7"></td>
                                                <td id="file-esrestinit-java-LC7" class="blob-code blob-code-inner js-file-line">    .<span class="pl-en">setSniffIntervalMillis</span>(<span class="pl-c1">SNIFFING_INTERVAL</span>)</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L8" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="8"></td>
                                                <td id="file-esrestinit-java-LC8" class="blob-code blob-code-inner js-file-line">    .<span class="pl-en">build</span>();</td>
                                            </tr>
                                            <tr>
                                                <td id="file-esrestinit-java-L9" class="blob-num js-line-number js-code-nav-line-number js-blob-rnum" data-line-number="9"></td>
                                                <td id="file-esrestinit-java-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-s1">sniffOnFailureListener</span>.<span class="pl-en">setSniffer</span>(<span class="pl-s1">sniffer</span>);</td>
                                            </tr>
                                            </tbody></table>
                                    </div>


                                </div>

                            </div>
                        </div>

                    </div>
                    <div class="gist-meta">
                        <a href="https://gist.github.com/reembs/8d190ba30d8b5c9d2bdeabdfa00e1496/raw/516bbd7df87a9f1f1d3f11cd6e05ae41c27a02a0/EsRestInit.java" style="float:right">view raw</a>
                        <a href="https://gist.github.com/reembs/8d190ba30d8b5c9d2bdeabdfa00e1496#file-esrestinit-java">
                            EsRestInit.java
                        </a>
                        hosted with ❤ by <a href="https://github.com">GitHub</a>
                    </div>
                </div>
            </div>

                <p>&nbsp;</p>
                <p>Right off the bat I noticed something strange here: The builder pattern used for the initialization of <span style="font-family: courier new, courier, monospace;">restClient</span> is very common in Java. Its semantics imply that once you call the <span style="font-family: courier new, courier, monospace;">build()</span> method you construct a new “final” object. While obviously syntactically possible, it is a bit confusing to have it get an empty instance of <span style="font-family: courier new, courier, monospace;">SniffOnFailureListener</span>&nbsp;that would get its <span style="font-family: courier new, courier, monospace;">setSniffer()</span> called after the <span style="font-family: courier new, courier, monospace;">build()</span> method that was already executed with the “final” instance created. Also, notice how <span style="font-family: courier new, courier, monospace;">sniffOnFailureListener</span> eventually contains a reference to <span style="font-family: courier new, courier, monospace;">sniffer</span> that contains a reference to <span style="font-family: courier new, courier, monospace;">restClient</span>. That’s while <span style="font-family: courier new, courier, monospace;">sniffOnFailureListener</span> is used in the initialization of that very same <span style="font-family: courier new, courier, monospace;">restClient</span>. It isn’t hard to imagine a situation in which this kind of reference chain can lead to bugs of a circular nature. I had an inkling that a thread synchronization issue was the culprit, so now I needed a thread dump.</p>
                <p>&nbsp;</p>
                <p>With my cluster online I started the tester app and produced some output for the valid state:</p>
                <pre><span style="font-size: 10pt;"><span style="font-family: terminal, monaco, monospace;">15:09:39.914 [KumulusThread-26] DEBUG com.forter.es.EsClientSnifferIT - StatusCode: 201, Result: created, SuccessShards: 2, FailedShards: 0</span>
<span style="font-family: terminal, monaco, monospace;">15:09:40.436 [pool-8-thread-1] DEBUG com.forter.utils.elasticsearch.ForterElasticsearchHostsSniffer - Sniffing ES hosts</span>
<span style="font-family: terminal, monaco, monospace;">15:09:41.121 [KumulusThread-27] DEBUG com.forter.es.EsClientSnifferIT - StatusCode: 201, Result: created, SuccessShards: 2, FailedShards: 0</span></span></pre>
                <p>One log line should be produced every ~1.1 second since the timeout in the requests is 100 milliseconds and I sleep 1 second in between them. Next, I need to terminate a machine (I chose to skip the deallocation step).</p>
                <p style="padding-left: 30px;"><strong>Side note</strong>: Another thing that comes in handy with VBox machines is that you can pause them. In that case, all processing stops, but the IP address isn’t returning connection refused errors like when you kill an underlying service. Instead, you are at the mercy of the network in search of a missing IP address. That’s perfect because it is exactly what happens when we terminate our cloud instances in production.</p>
                <p>Initially after terminating the slave machine, things go as expected:</p>
                <pre><span style="font-size: 12pt;"><span style="font-family: terminal, monaco, monospace;">15:15:18.427 [KumulusThread-32] ERROR com.forter.es.EsClientSnifferIT - Got exception: TimeoutException</span>
<span style="font-family: terminal, monaco, monospace;">15:15:19.740 [KumulusThread-33] ERROR com.forter.es.EsClientSnifferIT - Got exception: TimeoutException</span>
<span style="font-family: terminal, monaco, monospace;">15:15:21.055 [KumulusThread-34] ERROR com.forter.es.EsClientSnifferIT - Got exception: TimeoutException</span></span></pre>
                <p>Those <span style="font-family: courier new, courier, monospace;">TimeoutException</span> errors are good. They tell us the request failed, but it did so without blocking more than it should. Note that a line is printed every ~1.1 second. But that’s only for the first 3 seconds. Once a premature sniffing call is initiated due to use of <span style="font-family: courier new, courier, monospace;">setFailureListener()</span> in building the client, things break. Next on the log is:</p>
                <pre><span style="font-family: terminal, monaco, monospace; font-size: 12pt;">15:15:21.957 [pool-7-thread-1] DEBUG com.forter.utils.elasticsearch.ForterElasticsearchHostsSniffer - Sniffing ES hosts</span></pre>
                <p>And then, silence. The time is 15:15:21 and the next line on the log appears at 15:15:51. This tells the whole story:</p>
                <pre><span style="font-size: 12pt;"><span style="font-family: terminal, monaco, monospace;">Dec 25, 2017 3:15:51 PM org.elasticsearch.client.sniff.Sniffer sniff</span>
<span style="font-family: terminal, monaco, monospace;">SEVERE: error while sniffing nodes</span>
<span style="font-family: terminal, monaco, monospace;">java.io.IOException: listener timeout after waiting for [30000] ms</span>
<span style="font-family: terminal, monaco, monospace;">at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:617)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at com.forter.utils.elasticsearch.ForterElasticsearchHostsSniffer.sniffHosts(ForterElasticsearchHostsSniffer.java:69)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at org.elasticsearch.client.sniff.Sniffer.sniffOnFailure(Sniffer.java:59)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.concurrent.BasicFuture.failed(BasicFuture.java:134)</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.nio.pool.RouteSpecificPool.timeout(RouteSpecificPool.java:168)</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.nio.pool.AbstractNIOConnPool.requestTimeout(AbstractNIOConnPool.java:561)</span></span></pre>
                <p>The thread dump shows a similar stack trace on pool-7-thread-1 (note the call to sniffHosts):</p>
                <pre><span style="font-size: 12pt;"><span style="font-family: terminal, monaco, monospace;">"pool-7-thread-1" #68 prio=5 os_prio=31 tid=0x00007fc37b262800 nid=0x14603 waiting on condition [0x0000700006539000]</span>
<span style="font-family: terminal, monaco, monospace;">java.lang.Thread.State: TIMED_WAITING (parking)</span>
<span style="font-family: terminal, monaco, monospace;">at sun.misc.Unsafe.park(Native Method)</span>
<span style="font-family: terminal, monaco, monospace;">- parking to wait for &nbsp;&lt;0x00000007bff88000&gt; (a java.util.concurrent.CountDownLatch$Sync)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:277)</span>
<span style="font-family: terminal, monaco, monospace;">at org.elasticsearch.client.RestClient$SyncResponseListener.get(RestClient.java:616)</span>
<span style="font-family: terminal, monaco, monospace;">at org.elasticsearch.client.RestClient.performRequest(RestClient.java:212)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at com.forter.utils.elasticsearch.ForterElasticsearchHostsSniffer.sniffHosts(ForterElasticsearchHostsSniffer.java:69)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at org.elasticsearch.client.sniff.Sniffer.sniffOnFailure(Sniffer.java:59)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.impl.nio.client.AbstractClientExchangeHandler.connectionRequestFailed(AbstractClientExchangeHandler.java:335)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.nio.pool.AbstractNIOConnPool.requestTimeout(AbstractNIOConnPool.java:561)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">- locked &lt;0x00000007bff90328&gt; (a org.apache.http.impl.nio.reactor.SessionRequestImpl)</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processTimeouts(DefaultConnectingIOReactor.java:210)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">"KumulusThread-37" #52 daemon prio=5 os_prio=31 tid=0x00007fc377a7c000 nid=0x7e03 waiting on condition [0x0000700005509000]</span>
<span style="font-family: terminal, monaco, monospace;">java.lang.Thread.State: WAITING (parking)</span>
<span style="font-family: terminal, monaco, monospace;">at sun.misc.Unsafe.park(Native Method)</span>
<span style="font-family: terminal, monaco, monospace;">- parking to wait for &nbsp;&lt;0x0000000760661018&gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)</span>
<span style="font-family: terminal, monaco, monospace;">at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.nio.pool.AbstractNIOConnPool.lease(AbstractNIOConnPool.java:272)</span>
<span style="font-family: terminal, monaco, monospace;">at org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager.requestConnection(PoolingNHttpClientConnectionManager.java:266)</span>
<span style="font-family: terminal, monaco, monospace;">...</span>
<span style="font-family: terminal, monaco, monospace;">at com.forter.utils.storm.bolts.elasticsearch.AbstractElasticsearchRestBolt.execute(AbstractElasticsearchRestBolt.java:142)</span>
<span style="font-family: terminal, monaco, monospace;">...</span></span></pre>
                <p>So the Kumulus thread (KumulusThread-37) that’s supposed to block for a maximum of ~1.1 seconds is currently stuck on a lock at <span style="font-family: courier new, courier, monospace;">AbstractNIOConnPool.lease(AbstractNIOConnPool.java:272)</span> which is held by Apache HTTP client at thread pool-7-thread-1 <span style="font-family: courier new, courier, monospace;">AbstractNIOConnPool.requestTimeout(AbstractNIOConnPool.java:561)</span>.</p>
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <h2>Eureka! (Plus, workarounds fresh out the oven)</h2>
                <p>Basically, what happened here was that the ES REST client registered a callback to the Apache client’s onTimeout hook, and that callback is performed on a computation thread belonging to the Apache async HTTP client. The sniffer opted to do the sniffing operation I/O (an API call) on that thread, which is a bug. You are not supposed to block those threads for long, and <em>definitely</em> not supposed to do any blocking I/O operations on them. If you do, as demonstrated in our production env, all subsequent operations on the same client will be blocked until the I/O finishes (sniffing request times-out or finishes).</p>
                <p>I submitted a <a href="https://github.com/elastic/elasticsearch/pull/27985">PR</a> to fix the issue to the Elastic repository.</p>
                <p>In the meantime, if you are encountering this issue, the following workarounds can be applied:</p>
                <ul>
                    <li>Not using <span style="font-family: courier new, courier, monospace;">setFailureListener()</span></li>
                </ul>
                <ul>
                    <li>Killing the ES services on the de-allocated nodes manually before terminating them to produce connection refused errors in clients until they sniff the new cluster state (as speculated by my learned friend <a href="https://github.com/moshe">Moshe</a> prior to this reproduction).</li>
                </ul>
                <p>&nbsp;</p>
                <p>&nbsp;</p>
                <h2>Conclusions from a day’s work:</h2>
                <ul>
                    <li>From Apache HC’s perspective, you can say that the fault was with the user. The API was simply misused. See section 3.2.1 of the <a href="https://hc.apache.org/httpcomponents-core-ga/tutorial/html/nio.html">guide</a>, titled I/O dispatchers. It says clearly you shouldn’t block I/O dispatcher threads. But that’s a pretty easy detail to inadvertently ignore when implementing an interface. Java is missing a lot of fundamental language support for async operations so async implementations in Java tend to be cumbersome and complex (Apache Async HC as a perfect example). I wonder if an HTTP client written using Kotlin <a href="https://kotlinlang.org/docs/reference/coroutines.html">coroutines</a> can make that API clearer in the JVM.</li>
                    <li>The weirdness of the API, where the reference to the ES REST client was passed into its own member hierarchy turned out not to be the issue after all, but in some magical way the issue was hiding right around that corner. Coincidence?</li>
                    <li>Connection refused is my favorite of all errors. It happens fast and it tells you exactly what the problem is. Why can’t all errors be like that?</li>
                </ul>

            </div>

        </article>
    </div>
    <!-- end post -->


</main>
<!-- end content -->


<!-- begin footer -->
<footer class="footer">

    <div class="footer__inner">
        <div class="container">
            <div class="row">

                <div class="col col-5 col-d-12">
                    <div class="footer__author">
                        <div class="footer__author-avatar">
                            <img class="lazy" data-src="/images/forter.png" alt="Forter">
                        </div>
                        <h3 class="footer__author-name">Forter Engineering</h3>
                        <p class="footer__author-bio">Follow us on social media to stay up-to-date with cutting edge
                            technologies, </p>

                        <div class="social">
                            <ul class="social__list list-reset">

                                <li class="social__item">
                                    <a class="social__link" href="https://twitter.com/ForterGlobal" target="_blank"
                                       rel="noopener"
                                       aria-label=" link"><i class="ion ion-logo-twitter"></i></a>
                                </li>


                                <li class="social__item">
                                    <a class="social__link"
                                       href="https://www.linkedin.com/company/forter/mycompany/verification/"
                                       target="_blank" rel="noopener"
                                       aria-label=" link"><i class="ion ion-logo-linkedin"></i></a>
                                </li>


                                <li class="social__item">
                                    <a class="social__link" href="https://www.facebook.com/globalforter/"
                                       target="_blank" rel="noopener"
                                       aria-label=" link"><i class="ion ion-logo-facebook"></i></a>
                                </li>


                                <li class="social__item">
                                    <a class="social__link"
                                       href="https://www.youtube.com/channel/UCxAPyPoyVWu0yJbZ0gAvCqA" target="_blank"
                                       rel="noopener"
                                       aria-label=" link"><i class="ion ion-logo-youtube"></i></a>
                                </li>


                                <li class="social__item">
                                    <a class="social__link" href="https://github.com/forter" target="_blank"
                                       rel="noopener"
                                       aria-label=" link"><i class="ion ion-logo-github"></i></a>
                                </li>


                                <li class="social__item">
                                    <a class="social__link" href="mailto:tech@forter.com" target="_blank" rel="noopener"
                                       aria-label=" link"><i class="ion ion ion-md-mail"></i></a>
                                </li>

                            </ul>

                        </div>

                    </div>
                </div>


            </div>
        </div>
    </div>

    <div class="footer__info">
        <div class="container">
            <div class="row">
                <div class="col col-12">
                    <div class="footer__info-box">
                        <div class="top" title="Top"><i class="ion ion-ios-arrow-up"></i></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</footer>
<!-- end footer -->


<script src="/js/scripts.js"></script>
<script src="/js/common.js"></script>
</body>

</html>
